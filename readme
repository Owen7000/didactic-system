# Sending push notifications
Making use of Firebase Cloud Messaging for the ability to send push notifications to users. 

## DATA
The database will need to store the `token` for each users' device, as the token is unique to each device. The token is a `string` of length up to (not always this length though, so the database will need to be able to handle non-uniform lengths of data) but not greater than `4096` bytes (4KB, the max size of a cookie). These tokens change every so often, so there will need to be a way to update stored tokens.

## NodeJS Module
To send notifications with FCM, use the `firebase-admin` NPM package. You can install it with:
```
npm install --save firebase-admin 
```

## Sending notifications
Below is some sample code I've written that shows how to send notifications through `firebase-admin`. It's probably not perfect, however I've tested it on my Android device, and it works. You don't _need_ to use this code if you don't want to, I'll include links to the Firebase docs for if you want to dig deeper into them and do extra stuff. But the code here should be enough for what we need.

```js
const admin = require("firebase-admin");

const serviceAccount = require("./serviceAccountKey.json");

admin.initializeApp({
    credential: admin.credential.cert(serviceAccount)
});

const sendNotification = async (token) => {
    const message = {
        notification: {
            title: "Hello from Node.js",
            body: "This is a test push notification"
        },
        token: token
    };

    try {
        const response = await admin.messaging().send(message);
        console.log("Successfully sent message: ", response);
    } catch (error) {
        console.error("Error sending message: ", error)
    }
}

sendNotification("USER_TOKEN_GOES_HERE");
```

As you can see, it's pretty simple, so it should be easy enough to extend if you want to.
I won't put the `serviceAccountKey.json` file on GitHub, I'll share it individually with you if you need it for testing, but it's too sensitive to share on here. 
If you have any questions about it, either message me on Teams, or create an issue and include `@owen7000` somewhere, that way I'll find it!